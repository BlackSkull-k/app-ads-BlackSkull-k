<!DOCTYPE html>

<html lang="en">
<head><link as_="font" crossorigin="True" href="https://fonts.gstatic.com/s/poppins/v23/pxiEyp8kv8JHgFVrJJfedA.woff2" rel="preload" type="font/woff2"/><link as_="font" crossorigin="True" href="https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLEj6Z11l.woff2" rel="preload" type="font/woff2"/><link as_="font" crossorigin="True" href="https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLCz7Z11l.woff2" rel="preload" type="font/woff2"/>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>BlackSkull-k Apps - Snake</title>
<link href="images/bskFavicon32x.png" rel="icon" sizes="32x32" type="image/png"/>
<link href="images/bskFavicon180x.png" rel="apple-touch-icon" sizes="180x180"/>
<link href="/manifest.json" rel="manifest"/>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&amp;display=swap" rel="stylesheet"/>
<style>
/* STILI GENERALI */
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg, #2c3e50, #1b2836);
  color: #ecf0f1;
  display: flex;
  flex-direction: column;
  background-attachment: fixed;
}

header img {
  width: 100%;
  max-height: 200px;
  object-fit: cover;
  box-shadow: 0 4px 10px rgba(0,0,0,0.5);
  margin-bottom: 10px;
}

/* Navbar scorrevole con frecce */
.navbar-container {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: rgba(44, 62, 80, 0.8);
  box-shadow: 0 4px 6px rgba(0,0,0,0.2);
  padding: 10px 0;
}

.navbar {
  display: flex;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
  padding: 0 30px;
}

.navbar a {
  color: #ecf0f1;
  text-decoration: none;
  padding: 10px 18px;
  margin: 0 8px;
  font-weight: 500;
  border-radius: 20px;
  transition: all 0.3s ease;
  flex: 0 0 auto;
}

.navbar a:hover { background-color: #34495e; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
.navbar a.active { background-color: #0b47a1; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }

/* Frecce */
.nav-arrow {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  color: #ecf0f1;
  font-size: 20px;
  background: rgba(0,0,0,0.3);
  border-radius: 50%;
  width: 30px;
  height: 30px;
  line-height: 30px;
  text-align: center;
  cursor: pointer;
  user-select: none;
  z-index: 10;
  display: none;
}
.nav-arrow:hover { background: rgba(0,0,0,0.5); }

.nav-left { left: 5px; }
.nav-right { right: 5px; }

main {
  flex: 1;
  max-width: 1000px;
  margin: 20px auto;
  padding: 10px;
}

h2 { margin-bottom: 15px; text-align: center; color: #3498db; }

.content { padding-bottom: 60px; }

/* Barra inferiore */
.bottom-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background-color: rgba(44, 62, 80, 0.8);
  color: #f0f0f0;
  text-align: center;
  padding: 10px 0;
  font-size: 14px;
  box-shadow: 0 -2px 5px rgba(0,0,0,0.3);
  z-index: 1000;
}

/* Card bianca (aggiornata) */
.white-card {
  background: rgba(52, 73, 94, 0.8);
  border-radius: 15px;
  padding: 30px;
  margin-top: 30px;
  box-shadow: 0 10px 20px rgba(0,0,0,0.5);
  text-align: center;
  border: 2px solid #556b7f;
}

/* STILI DEL GIOCO */
#snake-game {
  text-align: center;
  position: relative;
}

#snakeGameCanvas {
  display: block;
  margin: 0 auto;
  background: #1a1a1a;
  border: 3px solid #333;
  border-radius: 10px;
  box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
  touch-action: none;
}

#snake-game-ui {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
  padding: 10px;
  background-color: rgba(255,255,255,0.05);
  border-radius: 10px;
  box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
  font-weight: 600;
  text-shadow: 1px 1px 2px #000;
}
#snake-game-ui button {
  background-color: #e67e22;
  color: #fff;
  border: none;
  padding: 10px 16px;
  border-radius: 8px;
  cursor: pointer;
  transition: background-color 0.3s, transform 0.1s;
  font-weight: 600;
  box-shadow: 0 4px 6px rgba(0,0,0,0.2);
}
#snake-game-ui button:hover {
  background-color: #d35400;
  transform: translateY(-2px);
}
#snake-game-ui button:active {
  transform: translateY(0);
}

.controls {
  margin-top: 20px;
  display: grid;
  grid-template-areas: ". up ." "left center right" ". down .";
  gap: 15px;
  justify-content: center;
}
.control-btn {
  background: linear-gradient(45deg, #1e2db6, #3498db);
  color: #fff;
  border: none;
  padding: 18px;
  border-radius: 12px;
  cursor: pointer;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  width: 60px;
  height: 60px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 28px;
  transition: background 0.3s, transform 0.1s;
}
.control-btn:hover { background: linear-gradient(45deg, #162090, #297fb8); transform: translateY(-2px); }
.control-btn:active { transform: translateY(0); box-shadow: 0 2px 4px rgba(0,0,0,0.3); }

#snakeControl-up { grid-area: up; }
#snakeControl-left { grid-area: left; }
#snakeControl-right { grid-area: right; }
#snakeControl-down { grid-area: down; }
#snakeControl-center { grid-area: center; visibility: hidden; }

/* Schermata di Game Over */
#snakeGameOverOverlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.85);
  color: #fff;
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 100;
  font-size: 1.5em;
  text-align: center;
  border-radius: 10px;
  animation: fadeIn 0.5s ease-out;
}
#snakeGameOverOverlay h3 {
    margin-bottom: 0.5em;
    font-size: 1.5em;
    font-weight: 700;
    color: #e74c3c;
    text-shadow: 2px 2px 4px #000;
}
#snakeGameOverOverlay p {
    margin: 0.2em 0;
    font-size: 0.8em;
}
#snakeGameOverOverlay button {
  margin-top: 1.5em;
  background-color: #e74c3c;
  color: #fff;
  border: none;
  padding: 12px 24px;
  border-radius: 8px;
  font-size: 0.8em;
  cursor: pointer;
  transition: background-color 0.3s, transform 0.1s;
  box-shadow: 0 4px 6px rgba(0,0,0,0.2);
}
#snakeGameOverOverlay button:hover {
  background-color: #c0392b;
  transform: translateY(-2px);
}

/* Schermata di selezione difficoltà */
#snakeStartOverlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.85);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 99;
}

/* Card difficoltà */
#snakeDifficultyCard {
    background: #1a1a1a;
    border: 3px solid #333;
    border-radius: 15px;
    padding: 40px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 10px 20px rgba(0,0,0,0.5);
    animation: scaleIn 0.5s ease-out;
}
#snakeDifficultyCard h2 { color: #fff; margin-bottom: 20px; text-shadow: 2px 2px 4px #000; }
#snakeDifficultyCard button {
  background: linear-gradient(45deg, #0b47a1, #3498db);
  color: #fff;
  border: none;
  padding: 12px 24px;
  margin: 10px 0;
  border-radius: 8px;
  cursor: pointer;
  width: 100%;
  font-size: 1.2em;
  font-weight: 600;
  transition: background 0.3s, transform 0.1s;
  box-shadow: 0 4px 6px rgba(0,0,0,0.2);
}
#snakeDifficultyCard button:hover { background: linear-gradient(45deg, #083884, #297fb8); transform: translateY(-2px); }

/* Keyframes per le animazioni */
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes scaleIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

</style>
</head>
<body>
<header>
<img alt="BlackSkull-k Logo" fetchpriority="high" src="images/Logo1.png"/>
</header>
<div class="navbar-container">
<div class="nav-arrow nav-left">❮</div>
<div class="navbar">
<a href="index.html">Home</a>
<a href="applications.html">Applications</a>
<a class="active" href="flashgames.html">Flash Games</a>
<a href="contacts.html">Contacts</a>
<a href="affiliatesites.html">Affiliate Sites</a>
</div>
<div class="nav-arrow nav-right">❯</div>
</div>
<main class="content">
<div class="white-card">
<div id="snake-game">
<h2>Snake</h2>
<div id="snake-game-ui">
<span id="snakeScoreDisplay">Score: <span id="snakeScoreSpan">0</span></span>
<span id="snakeHighscoreDisplay">Highscore: <span id="snakeHighscoreSpan">0</span></span>
<button id="snake-restart-btn">Restart</button>
</div>
<canvas height="320" id="snakeGameCanvas" width="320"></canvas>
<div class="controls">
<button class="control-btn" id="snakeControl-up">▲</button>
<button class="control-btn" id="snakeControl-left">◀</button>
<div id="snakeControl-center"></div>
<button class="control-btn" id="snakeControl-right">▶</button>
<button class="control-btn" id="snakeControl-down">▼</button>
</div>
<!-- Overlays -->
<div id="snakeGameOverOverlay">
<h3>Game Over!</h3>
<p>Your Score: <span id="snakeFinalScore">0</span></p>
<p>Highscore: <span id="snakeFinalHighscore">0</span></p>
<button id="snakeRestartOverlayBtn">Play Again</button>
</div>
<div id="snakeStartOverlay">
<div id="snakeDifficultyCard">
<h2>Select Difficulty</h2>
<button id="snakeEasyBtn">Easy</button>
<button id="snakeMediumBtn">Medium</button>
<button id="snakeHardBtn">Hard</button>
</div>
</div>
</div>
</div>
</main>
<div class="bottom-bar">
    BlackSkull-k ® 2021-2025
</div>
<script>
// Gestione freccette navbar
const nav = document.querySelector('.navbar');
const leftArrow = document.querySelector('.nav-left');
const rightArrow = document.querySelector('.nav-right');
const activeLink = document.querySelector('.navbar a.active');

function updateArrows() {
  if (nav.scrollWidth > nav.clientWidth) {
    // Aggiungi una piccola tolleranza per risolvere i problemi su mobile
    const atStart = nav.scrollLeft <= 1;
    const atEnd = Math.ceil(nav.scrollLeft + nav.clientWidth) >= nav.scrollWidth;

    leftArrow.style.display = atStart ? "none" : "block";
    rightArrow.style.display = atEnd ? "none" : "block";
  } else {
    leftArrow.style.display = "none";
    rightArrow.style.display = "none";
  }
}

// Funzione per centrare il link attivo
function centerActiveLink() {
  if (activeLink) {
    const scrollPosition = activeLink.offsetLeft - (nav.offsetWidth / 2) + (activeLink.offsetWidth / 2);
    nav.scrollLeft = scrollPosition;
    updateArrows();
  }
}


leftArrow.addEventListener('click', () => {
  nav.scrollBy({ left: -150, behavior: 'smooth' });
});
rightArrow.addEventListener('click', () => {
  nav.scrollBy({ left: 150, behavior: 'smooth' });
});

nav.addEventListener('scroll', updateArrows);
window.addEventListener('resize', updateArrows);
window.addEventListener('load', () => {
  centerActiveLink();
  updateArrows();
});

// LOGICA DEL GIOCO SNAKE
const snakeCanvas = document.getElementById('snakeGameCanvas');
const snakeCtx = snakeCanvas.getContext('2d');
const snakeScoreSpan = document.getElementById('snakeScoreSpan');
const snakeHighscoreSpan = document.getElementById('snakeHighscoreSpan');
const snakeFinalScore = document.getElementById('snakeFinalScore');
const snakeFinalHighscore = document.getElementById('snakeFinalHighscore');
const snakeGameOverOverlay = document.getElementById('snakeGameOverOverlay');
const snakeStartOverlay = document.getElementById('snakeStartOverlay');
const snakeRestartBtn = document.getElementById('snake-restart-btn');
const snakeRestartOverlayBtn = document.getElementById('snakeRestartOverlayBtn');
const snakeEasyBtn = document.getElementById('snakeEasyBtn');
const snakeMediumBtn = document.getElementById('snakeMediumBtn');
const snakeHardBtn = document.getElementById('snakeHardBtn');

let snake;
let snakeFood;
let snakeDirection;
let nextDirection; // Variabile per la direzione in attesa
let snakeSpeed;
let snakeScore;
let snakeHighscore = localStorage.getItem('snakeHighscore') || 0;
let snakeGameLoop;
let snakeSparks = [];
let snakeObstacles = []; // Nuova variabile per gli ostacoli
const snakeBox = 16;
let snakeGameStarted = false;

// Audio
const snakeEatSound = new Audio("https://cdn.glitch.global/c3f6f199-a9a7-4767-9d7a-5a9e3650212f/eat.mp3?v=1678829672689");
const snakeDeathSound = new Audio("https://cdn.glitch.global/c3f6f199-a9a7-4767-9d7a-5a9e3650212f/death.mp3?v=1678829671689");

function snakeRandomFood() {
  let newFood;
  do {
    newFood = {
      x: Math.floor(Math.random() * (snakeCanvas.width / snakeBox)) * snakeBox,
      y: Math.floor(Math.random() * (snakeCanvas.height / snakeBox)) * snakeBox,
    };
  } while (snakeObstacles.some(obs => obs.x === newFood.x && obs.y === newFood.y) || 
           snake.some(part => part.x === newFood.x && part.y === newFood.y));
  return newFood;
}

// Funzione per generare gli ostacoli
function generateObstacles(difficulty) {
  snakeObstacles = []; // Pulisci gli ostacoli precedenti
  if (difficulty === 7.5) { // Difficoltà media
    const centerX = Math.floor(snakeCanvas.width / (2 * snakeBox)) * snakeBox;
    const centerY = Math.floor(snakeCanvas.height / (2 * snakeBox)) * snakeBox;
    
    // Genera un ostacolo a croce al centro
    snakeObstacles.push({ x: centerX, y: centerY });
    snakeObstacles.push({ x: centerX - snakeBox, y: centerY });
    snakeObstacles.push({ x: centerX + snakeBox, y: centerY });
    snakeObstacles.push({ x: centerX, y: centerY - snakeBox });
    snakeObstacles.push({ x: centerX, y: centerY + snakeBox });
  } else if (difficulty === 10.5) { // Difficoltà difficile
    // Posizioni predefinite per i muri
    const wallConfigurations = [
      // Muro verticale a sinistra e muro orizzontale in basso
      [
        {x: 6*snakeBox, y: 3*snakeBox}, {x: 6*snakeBox, y: 4*snakeBox}, {x: 6*snakeBox, y: 5*snakeBox}, {x: 6*snakeBox, y: 6*snakeBox},
        {x: 14*snakeBox, y: 14*snakeBox}, {x: 15*snakeBox, y: 14*snakeBox}, {x: 16*snakeBox, y: 14*snakeBox}
      ],
      // Muro orizzontale in alto e muro verticale a destra
      [
        {x: 5*snakeBox, y: 5*snakeBox}, {x: 6*snakeBox, y: 5*snakeBox}, {x: 7*snakeBox, y: 5*snakeBox},
        {x: 15*snakeBox, y: 10*snakeBox}, {x: 15*snakeBox, y: 11*snakeBox}, {x: 15*snakeBox, y: 12*snakeBox}, {x: 15*snakeBox, y: 13*snakeBox}
      ],
      // Due muri verticali al centro
      [
        {x: 6*snakeBox, y: 4*snakeBox}, {x: 6*snakeBox, y: 5*snakeBox}, {x: 6*snakeBox, y: 6*snakeBox}, {x: 6*snakeBox, y: 7*snakeBox},
        {x: 14*snakeBox, y: 10*snakeBox}, {x: 14*snakeBox, y: 11*snakeBox}, {x: 14*snakeBox, y: 12*snakeBox}, {x: 14*snakeBox, y: 13*snakeBox}
      ]
    ];
    
    // Scegli una configurazione casuale
    const selectedWalls = wallConfigurations[Math.floor(Math.random() * wallConfigurations.length)];
    snakeObstacles = selectedWalls.map(wall => ({
      x: wall.x,
      y: wall.y
    }));
  }
}

function snakeDraw() {
  // Pulisci il canvas
  snakeCtx.fillStyle = '#1a1a1a';
  snakeCtx.fillRect(0, 0, snakeCanvas.width, snakeCanvas.height);

  // Disegna il cibo (mela) con colori neon rossi
  snakeCtx.shadowColor = '#FF073A'; // Colore rosso neon per l'ombra
  snakeCtx.shadowBlur = 15;        // Applica un effetto sfocato
  snakeCtx.fillStyle = '#FF073A'; // Colore rosso neon per il cibo
  snakeCtx.beginPath();
  snakeCtx.arc(snakeFood.x + snakeBox / 2, snakeFood.y + snakeBox / 2, snakeBox / 2, 0, 2 * Math.PI);
  snakeCtx.fill();
  snakeCtx.shadowBlur = 0; // Azzera l'ombra per gli altri elementi

  // Disegna gli ostacoli
  snakeCtx.fillStyle = '#6c7a89'; // Un grigio scuro per gli ostacoli
  snakeObstacles.forEach(obs => {
    snakeCtx.fillRect(obs.x, obs.y, snakeBox, snakeBox);
    snakeCtx.strokeStyle = '#333';
    snakeCtx.strokeRect(obs.x, obs.y, snakeBox, snakeBox);
  });

  // Imposta le proprietà per l'effetto neon del serpente
  snakeCtx.shadowColor = '#39FF14'; 
  snakeCtx.shadowBlur = 10;
  
  // Disegna il serpente con angoli arrotondati
  snake.forEach((part, index) => {
    // Se è la testa (index 0), usa un colore leggermente più scuro
    if (index === 0) {
      snakeCtx.fillStyle = '#00A000'; // Testa del serpente più scura
    } else {
      snakeCtx.fillStyle = '#00FF00'; // Corpo del serpente verde neon
    }
    
    snakeCtx.strokeStyle = '#008000'; // Bordo verde scuro per tutto il serpente
    snakeCtx.lineWidth = 1;

    snakeCtx.beginPath();
    snakeCtx.roundRect(part.x, part.y, snakeBox, snakeBox, 5); // Angoli arrotondati
    snakeCtx.fill();
    snakeCtx.stroke();
  });
  
  snakeCtx.shadowBlur = 0; // Azzera l'ombra per gli altri elementi
  
  // Disegna le scintille
  snakeCtx.fillStyle = 'rgba(255,255,255,0.7)';
  snakeSparks = snakeSparks.filter(spark => spark.life > 0);
  snakeSparks.forEach(spark => {
    snakeCtx.fillRect(spark.x, spark.y, 2, 2);
    spark.x += spark.dx;
    spark.y += spark.dy;
    spark.life--;
  });
}

function snakeCollision() {
  const head = snake[0];
  // Controlla i muri
  if (head.x < 0 || head.x >= snakeCanvas.width || head.y < 0 || head.y >= snakeCanvas.height) {
    return true;
  }
  // Controlla l'auto-collisione
  for (let i = 1; i < snake.length; i++) {
    if (head.x === snake[i].x && head.y === snake[i].y) {
      return true;
    }
  }
  // Controlla la collisione con gli ostacoli
  for (let i = 0; i < snakeObstacles.length; i++) {
    if (head.x === snakeObstacles[i].x && head.y === snakeObstacles[i].y) {
      return true;
    }
  }
  return false;
}

function snakeGameReset() {
  clearInterval(snakeGameLoop);
  snake = [{ x: 0, y: Math.floor(snakeCanvas.height / (2 * snakeBox)) * snakeBox }];
  snakeDirection = 'right';
  nextDirection = 'right'; // Imposta la direzione iniziale in attesa
  snakeScore = 0;
  snakeObstacles = []; // Assicurati che gli ostacoli siano vuoti prima di iniziare
  snakeFood = snakeRandomFood();
  snakeGameStarted = false;
  snakeScoreSpan.textContent = snakeScore;
  snakeGameOverOverlay.style.display = 'none';
  snakeStartOverlay.style.display = 'flex';
}

function snakeStartGame(difficulty) {
  snakeStartOverlay.style.display = 'none';
  snakeGameStarted = true;
  snakeSpeed = difficulty;
  generateObstacles(difficulty); // Genera gli ostacoli in base alla difficoltà
  snakeFood = snakeRandomFood(); // Genera il cibo dopo gli ostacoli per evitare sovrapposizioni
  snakeGameLoop = setInterval(snakeGameTick, 1000 / snakeSpeed);
}

function snakeGameTick() {
  if (!snakeGameStarted) return;
  
  // Aggiorna la direzione solo una volta per tick
  if ((nextDirection === 'up' && snakeDirection !== 'down') ||
      (nextDirection === 'down' && snakeDirection !== 'up') ||
      (nextDirection === 'left' && snakeDirection !== 'right') ||
      (nextDirection === 'right' && snakeDirection !== 'left')) {
      snakeDirection = nextDirection;
  }

  const head = { x: snake[0].x, y: snake[0].y };

  switch (snakeDirection) {
    case 'up': head.y -= snakeBox; break;
    case 'down': head.y += snakeBox; break;
    case 'left': head.x -= snakeBox; break;
    case 'right': head.x += snakeBox; break;
  }
  
  snake.unshift(head);
  if (snakeCollision()) {
    snakeDeathSound.play();
    clearInterval(snakeGameLoop);
    snakeGameStarted = false;
    
    // Aggiorna il punteggio più alto
    if (snakeScore > snakeHighscore) {
      snakeHighscore = snakeScore;
      localStorage.setItem('snakeHighscore', snakeHighscore);
    }
    snakeFinalScore.textContent = snakeScore;
    snakeFinalHighscore.textContent = snakeHighscore;
    snakeHighscoreSpan.textContent = snakeHighscore;
    
    snakeGameOverOverlay.style.display = 'flex';
  } else {
    if (head.x === snakeFood.x && head.y === snakeFood.y) {
      snakeScore++;
      snakeScoreSpan.textContent = snakeScore;
      snakeEatSound.currentTime = 0;
      snakeEatSound.play();
      
      // AUMENTA LA VELOCITÀ DOPO AVER MANGIATO
      if (snakeScore > 0 && snakeScore % 5 === 0) {
        snakeSpeed += 0.2;
        clearInterval(snakeGameLoop);
        snakeGameLoop = setInterval(snakeGameTick, 1000 / snakeSpeed);
      }
      
      // Nuovo effetto scintilla
      snakeSparks.push(...Array(50).fill().map(() => ({
        x: snakeFood.x + snakeBox / 2, y: snakeFood.y + snakeBox / 2, life: 5, dx: (Math.random() * 2 - 1) * 3, dy: (Math.random() * 2 - 1) * 3
      })));
      snakeFood = snakeRandomFood();
    } else {
      snake.pop();
    }
    snakeDraw();
  }
}

// Controlli da tastiera
document.addEventListener('keydown', e => {
  // Impedisci il comportamento di scorrimento predefinito per i tasti freccia
  if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
    e.preventDefault();
  }
  
  if (!snakeGameStarted) return;
  switch (e.key) {
    case 'ArrowUp': if (snakeDirection !== 'down') nextDirection = 'up'; break;
    case 'ArrowDown': if (snakeDirection !== 'up') nextDirection = 'down'; break;
    case 'ArrowLeft': if (snakeDirection !== 'right') nextDirection = 'left'; break;
    case 'ArrowRight': if (snakeDirection !== 'left') nextDirection = 'right'; break;
  }
});

// Controlli da pulsanti
document.getElementById('snakeControl-up').addEventListener('click', () => { if (snakeDirection !== 'down') nextDirection = 'up'; });
document.getElementById('snakeControl-down').addEventListener('click', () => { if (snakeDirection !== 'up') nextDirection = 'down'; });
document.getElementById('snakeControl-left').addEventListener('click', () => { if (snakeDirection !== 'right') nextDirection = 'left'; });
document.getElementById('snakeControl-right').addEventListener('click', () => { if (snakeDirection !== 'left') nextDirection = 'right'; });

// Swipe touch
let snakeTouchStartX = 0;
let snakeTouchStartY = 0;
snakeCanvas.addEventListener("touchstart", e => {
  const touch = e.touches[0];
  snakeTouchStartX = touch.clientX;
  snakeTouchStartY = touch.clientY;
}, { passive: false });
snakeCanvas.addEventListener("touchmove", e => {
  e.preventDefault(); 
}, { passive: false });
snakeCanvas.addEventListener("touchend", e => {
  const touch = e.changedTouches[0];
  const dx = touch.clientX - snakeTouchStartX;
  const dy = touch.clientY - snakeTouchStartY;

  if (Math.abs(dx) > Math.abs(dy)) { // Swipe orizzontale
    if (dx > 0) {
      if (snakeDirection !== 'left') nextDirection = 'right';
    } else {
      if (snakeDirection !== 'right') nextDirection = 'left';
    }
  } else { // Swipe verticale
    if (dy > 0) {
      if (snakeDirection !== 'up') nextDirection = 'down';
    } else {
      if (snakeDirection !== 'down') nextDirection = 'up';
    }
  }
}, { passive: false });

// Listener per gli eventi dell'interfaccia utente
snakeRestartBtn.addEventListener('click', snakeGameReset);
snakeRestartOverlayBtn.addEventListener('click', snakeGameReset);
snakeEasyBtn.addEventListener('click', () => snakeStartGame(5));
snakeMediumBtn.addEventListener('click', () => snakeStartGame(7.5));
snakeHardBtn.addEventListener('click', () => snakeStartGame(10.5));

// Configurazione iniziale del gioco
snakeGameReset();
snakeHighscoreSpan.textContent = snakeHighscore;
</script>
</body>
</html>
