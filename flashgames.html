<!DOCTYPE ahtml>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BlackSkull-k Apps - Flash Games</title>
<link rel="icon" type="image/png" sizes="32x32" href="images/bskFavicon32x.png">
<link rel="apple-touch-icon" sizes="180x180" href="images/bskFavicon180x.png">
<link rel="manifest" href="/manifest.json">
<style>
/* STILE GENERALE */
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  font-family: Arial, sans-serif;
  background: #9d9f9f;
  color: #333;
  display: flex;
  flex-direction: column;
}

header img {
  width: 100%;
  max-height: 200px;
  object-fit: cover;
  box-shadow: 0 4px 10px rgba(0,0,0,0.5);
  margin-bottom: 10px;
}

/* Navbar scrollabile con freccette */
.navbar-container {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #2c3e50;
  box-shadow: 0 4px 6px rgba(0,0,0,0.2);
  padding: 10px 0;
}

.navbar {
  display: flex;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
  padding: 0 30px;
}

.navbar a {
  color: #ecf0f1;
  text-decoration: none;
  padding: 10px 18px;
  margin: 0 8px;
  font-weight: 500;
  border-radius: 20px;
  transition: all 0.3s ease;
  flex: 0 0 auto;
}

.navbar a:hover { background-color: #34495e; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
.navbar a.active { background-color: #0b47a1; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }

/* Freccette */
.nav-arrow {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  color: #ecf0f1;
  font-size: 20px;
  background: rgba(0,0,0,0.3);
  border-radius: 50%;
  width: 30px;
  height: 30px;
  line-height: 30px;
  text-align: center;
  cursor: pointer;
  user-select: none;
  z-index: 10;
  display: none;
}
.nav-arrow:hover { background: rgba(0,0,0,0.5); }

.nav-left { left: 5px; }
.nav-right { right: 5px; }

main {
  flex: 1;
  max-width: 1000px;
  margin: 20px auto;
  padding: 10px;
}
h2 { margin-bottom: 15px; text-align: center; color: #0b47a1; }

.content { padding-bottom: 60px; }

/* Barra inferiore */
.bottom-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background-color: #2c3e50;
  color: #f0f0f0;
  text-align: center;
  padding: 10px 0;
  font-size: 14px;
  box-shadow: 0 -2px 5px rgba(0,0,0,0.3);
  z-index: 1000;
}

/* STILE DEL GIOCO SNAKE */
#snake-game {
  text-align: center;
}

#gameCanvas {
  display: block;
  margin: 0 auto;
  border: 2px solid #222;
  border-radius: 10px;
}

#game-ui {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
  padding: 5px 10px;
  background-color: rgba(0,0,0,0.1);
  border-radius: 5px;
}
#game-ui button {
  background-color: #e67e22;
  color: #fff;
  border: none;
  padding: 8px 12px;
  border-radius: 5px;
  cursor: pointer;
}
#game-ui button:hover {
  background-color: #d35400;
}

.controls {
  margin-top: 10px;
  display: grid;
  grid-template-areas: ". up ." "left center right" ". down .";
  gap: 10px;
  justify-content: center;
}
.control-btn {
  background-color: #1e2db6;
  color: #fff;
  border: none;
  padding: 15px;
  border-radius: 5px;
  cursor: pointer;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  width: 50px;
  height: 50px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 24px;
}
.control-btn:hover { background-color: #162090; }
#control-up { grid-area: up; }
#control-left { grid-area: left; }
#control-right { grid-area: right; }
#control-down { grid-area: down; }
#control-center { grid-area: center; visibility: hidden; }

/* Overlay di game over */
#gameOverOverlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.7); /* Sfondo semi-trasparente */
  color: #fff;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 100;
  font-size: 2em;
  text-align: center;
}
#gameOverOverlay button {
  margin-top: 20px;
  background-color: #0b47a1;
  color: #fff;
  border: none;
  padding: 10px 20px;
  border-radius: 5px;
  font-size: 0.7em;
  cursor: pointer;
}

/* Overlay di selezione difficoltà */
#start-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.7); /* Sfondo semi-trasparente */
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 100;
  flex-direction: column;
}

#difficulty-select {
  padding: 10px;
  font-size: 1.2em;
  border-radius: 5px;
  border: none;
  margin-bottom: 20px;
}

#start-button {
  background-color: #e67e22;
  color: #fff;
  border: none;
  padding: 15px 30px;
  border-radius: 5px;
  font-size: 1.5em;
  cursor: pointer;
  transition: background-color 0.3s;
}

#start-button:hover {
  background-color: #d35400;
}

.score-display {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 10px;
  font-size: 1.2em;
}

.score-display .score-box {
  background: rgba(0,0,0,0.1);
  padding: 5px 15px;
  border-radius: 5px;
  min-width: 100px;
}
</style>
</head>
<body>

<header>
  <img src="https://i.ibb.co/6P6X73h/blackskull-k-banner-games.webp" alt="BlackSkull-k Apps Games Banner">
</header>

<div class="navbar-container">
  <div class="nav-arrow nav-left" onclick="scrollNav(-1)">&#9664;</div>
  <nav class="navbar">
    <a href="index.html">HOME</a>
    <a href="apps.html">APPS</a>
    <a href="flashgames.html" class="active">FLASH GAMES</a>
    <a href="contacts.html">CONTATTI</a>
  </nav>
  <div class="nav-arrow nav-right" onclick="scrollNav(1)">&#9654;</div>
</div>

<main>
  <h2>SNAKE - Il classico</h2>
  <div class="content">
    <div id="snake-game">
      <div id="game-ui">
        <span id="score">Score: 0</span>
        <span id="speed-display">Speed: 1</span>
        <button id="startBtn">Start</button>
      </div>
      <canvas id="gameCanvas" width="400" height="400"></canvas>
      <div class="score-display">
        <span class="score-box">Best Score: <span id="bestScore">0</span></span>
      </div>
      <div class="controls">
        <button id="control-up" class="control-btn">&#9650;</button>
        <button id="control-left" class="control-btn">&#9664;</button>
        <div id="control-center"></div>
        <button id="control-right" class="control-btn">&#9654;</button>
        <button id="control-down" class="control-btn">&#9660;</button>
      </div>

      <div id="gameOverOverlay" style="display: none;">
        <span>GAME OVER</span>
        <span>Score: <span id="finalScore">0</span></span>
        <button onclick="window.location.reload();">Riprova</button>
      </div>

      <div id="start-overlay">
        <h3>Seleziona la difficoltà</h3>
        <select id="difficulty-select">
          <option value="15">Facile</option>
          <option value="12" selected>Normale</option>
          <option value="9">Difficile</option>
          <option value="6">Estrema</option>
        </select>
        <button id="start-button">INIZIA A GIOCARE</button>
      </div>
    </div>
  </div>
</main>

<div class="bottom-bar">
    BlackSkull-k 2021 2025
</div>

<script>
// Gestione freccette navbar
const nav = document.querySelector('.navbar');
const leftArrow = document.querySelector('.nav-left');
const rightArrow = document.querySelector('.nav-right');

function updateArrows() {
  if (nav.scrollWidth > nav.clientWidth) {
    leftArrow.style.display = nav.scrollLeft > 0 ? "block" : "none";
    rightArrow.style.display = (nav.scrollLeft + nav.clientWidth < nav.scrollWidth) ? "block" : "none";
  } else {
    leftArrow.style.display = "none";
    rightArrow.style.display = "none";
  }
}

leftArrow.addEventListener('click', () => {
  nav.scrollBy({ left: -150, behavior: 'smooth' });
});
rightArrow.addEventListener('click', () => {
  nav.scrollBy({ left: 150, behavior: 'smooth' });
});

window.addEventListener('resize', updateArrows);
document.addEventListener('DOMContentLoaded', updateArrows);

// Inizializzazione gioco Snake
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const box = 20;
let snake = [];
let food;
let score = 0;
let bestScore = localStorage.getItem("snakeBestScore") || 0;
const scoreSpan = document.getElementById("score");
const bestScoreSpan = document.getElementById("bestScore");
const speedDisplay = document.getElementById("speed-display");
const finalScoreSpan = document.getElementById("finalScore");
const gameOverOverlay = document.getElementById("gameOverOverlay");
const startOverlay = document.getElementById("start-overlay");
const difficultySelect = document.getElementById("difficulty-select");

bestScoreSpan.textContent = bestScore;

// Suoni
const eatSound = new Audio('https://www.soundboard.com/media/19087');
const gameOverSound = new Audio('https://www.soundboard.com/media/20524');

let d, nextD;
let gameRunning = false;
let flashing = 0;
let sparks = [];

let speed = parseInt(difficultySelect.value);
speedDisplay.textContent = speed;

// Sfondo del gioco
const backgroundImage = new Image();
backgroundImage.src = 'https://i.imgur.com/k91Jv5p.png';

// Inizializza tutto e disegna
function init(){
  snake = [{x: 9 * box, y: 10 * box}];
  d = "RIGHT";
  nextD = "RIGHT";
  food = randomFood();
  score = 0;
  scoreSpan.textContent = score;
  sparks = [];
  speed = parseInt(difficultySelect.value);
  speedDisplay.textContent = "Speed: " + speed;
  gameRunning = true;
  lastTime = 0;
}

// disegna tutto
function draw(){
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);

  for(let i = 0; i < snake.length; i++){
    ctx.fillStyle = (i === 0) ? "#16a085" : "#1abc9c";
    ctx.fillRect(snake[i].x, snake[i].y, box, box);

    ctx.strokeStyle = "#2c3e50";
    ctx.strokeRect(snake[i].x, snake[i].y, box, box);
  }

  // Draw food
  ctx.fillStyle = "#e74c3c";
  ctx.fillRect(food.x, food.y, box, box);

  // Draw sparks
  for (let i = sparks.length - 1; i >= 0; i--) {
    let s = sparks[i];
    s.x += s.dx;
    s.y += s.dy;
    s.life--;
    ctx.fillStyle = `rgba(231, 76, 60, ${s.life / 10})`;
    ctx.fillRect(s.x, s.y, 4, 4);
    if (s.life <= 0) {
      sparks.splice(i, 1);
    }
  }

  // draw score
  if(flashing > 0){
    ctx.fillStyle = (flashing % 2 == 0) ? "#e74c3c" : "#fff";
    flashing--;
    ctx.font = "bold 50px Arial";
    ctx.textAlign = "center";
    ctx.fillText(score, canvas.width / 2, canvas.height / 2);
  }
}

function randomFood(){
  let x, y;
  let isOccupied;
  do {
    x = Math.floor(Math.random() * (canvas.width/box)) * box;
    y = Math.floor(Math.random() * (canvas.height/box)) * box;
    isOccupied = snake.some(s => s.x === x && s.y === y);
  } while (isOccupied);
  return {x, y};
}

// controller
document.addEventListener("keydown", direction);
function direction(event){
  let key = event.keyCode;
  if(key == 37 && nextD != "RIGHT"){
    nextD = "LEFT";
  } else if(key == 38 && nextD != "DOWN"){
    nextD = "UP";
  } else if(key == 39 && nextD != "LEFT"){
    nextD = "RIGHT";
  } else if(key == 40 && nextD != "UP"){
    nextD = "DOWN";
  }
}

// update
let lastTime = 0;
function update(time){
  if(!gameRunning) return;
  if(time - lastTime > 1000/speed){
    d = nextD;
    
    let snakeX = snake[0].x;
    let snakeY = snake[0].y;

    if( d == "LEFT") snakeX -= box;
    if( d == "UP") snakeY -= box;
    if( d == "RIGHT") snakeX += box;
    if( d == "DOWN") snakeY += box;

    let head = {x: snakeX, y: snakeY};

    function collision(head, array){
      for(let i = 0; i < array.length; i++){
        if(head.x == array[i].x && head.y == array[i].y){
          return true;
        }
      }
      return false;
    }

    if(head.x < 0 || head.x >= canvas.width || head.y < 0 || head.y >= canvas.height || collision(head, snake)){
      gameRunning = false;
      gameOverSound.play();
      flashing = 6;
      finalScoreSpan.textContent = score;
      gameOverOverlay.style.display = "flex";

      if (score > bestScore) {
        bestScore = score;
        bestScoreSpan.textContent = bestScore;
        localStorage.setItem("snakeBestScore", bestScore);
      }
      return;
    }

    snake.unshift(head);

    if (head.x === food.x && head.y === food.y) {
      score++;
      scoreSpan.textContent = score;
      eatSound.currentTime = 0;
      eatSound.play();
      sparks.push(...Array(20).fill().map(() => ({
        x: food.x + box / 2, y: food.y + box / 2, life: 10, dx: Math.random() * 2 - 1, dy: Math.random() * 2 - 1
      })));
      food = randomFood();
    } else {
      snake.pop();
    }
    draw();
    lastTime = time;
  }
  requestAnimationFrame(update);
}

// pulsante start/restart
document.getElementById("startBtn").addEventListener("click", () => {
  init();
  requestAnimationFrame(update);
  document.getElementById("startBtn").textContent = "Restart";
});

// loop
function gameLoop(time){
  if(!gameRunning) return;
  if(time - lastTime > 1000/speed){
    draw();
    lastTime = time;
  }
  requestAnimationFrame(gameLoop);
}

// swipe touch
let touchStartX = 0;
let touchStartY = 0;
canvas.addEventListener("touchstart", e => {
  const touch = e.touches[0];
  touchStartX = touch.clientX;
  touchStartY = touch.clientY;
}, { passive: false });
canvas.addEventListener("touchmove", e => {
  e.preventDefault(); 
}, { passive: false });
canvas.addEventListener("touchend", e => {
  const touch = e.changedTouches[0];
  const dx = touch.clientX - touchStartX;
  const dy = touch.clientY - touchStartY;

  if (Math.abs(dx) > Math.abs(dy)) {
    // Horizontal swipe
    if (dx > 0 && nextD !== "LEFT") {
      nextD = "RIGHT";
    } else if (dx < 0 && nextD !== "RIGHT") {
      nextD = "LEFT";
    }
  } else {
    // Vertical swipe
    if (dy > 0 && nextD !== "UP") {
      nextD = "DOWN";
    } else if (dy < 0 && nextD !== "DOWN") {
      nextD = "UP";
    }
  }
}, { passive: false });

document.getElementById("start-button").addEventListener("click", () => {
  init();
  requestAnimationFrame(update);
  startOverlay.style.display = "none";
});

// Controlli da tastiera
document.addEventListener("keydown", e => {
  if (e.key === "ArrowLeft" && nextD !== "RIGHT") {
    nextD = "LEFT";
  } else if (e.key === "ArrowUp" && nextD !== "DOWN") {
    nextD = "UP";
  } else if (e.key === "ArrowRight" && nextD !== "LEFT") {
    nextD = "RIGHT";
  } else if (e.key === "ArrowDown" && nextD !== "UP") {
    nextD = "DOWN";
  }
});
</script>

</body>
</html>
